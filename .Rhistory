select(dato,
kampstart,
ugedag,
runde,
ude,
mean_spild,
sidste_spild,
mean_afhentningsgrad,
mean_tilskuere,
sidste_tilskuer_antal,
mean_temp_6h,
mean_precip_6h,
mean_precip_dur_6h,
mean_wind_speed_6h
) # y-variable + 13 + tidspunktskategori, lokalopgør, weekend, type
samlet_data <- as_tibble(samlet_vff) |>
mutate(
dato = as.Date(dato, origin = "1970-01-01"),
kampstart = hms(parse_time(kampstart)),
tid = hms(parse_time(tid))
)
samlet_data_flot <- samlet_data |>
filter(
kampstart >= tid & kampstart - hours(6) <= tid
) |>
group_by(dato) |>
mutate(
mean_temp_6h = round(mean(temp_mean_past1h), 1),
mean_precip_6h = round(mean(precip_past1h), 1),
mean_precip_dur_6h = round(mean(precip_dur_past1h), 1),
mean_wind_speed_6h = round(mean(wind_speed_past1h), 1)
) |>
slice_head() |>
ungroup() |>
select(dato,
kampstart,
ugedag,
runde,
ude,
mean_spild,
sidste_spild,
mean_afhentningsgrad,
mean_tilskuere,
sidste_tilskuer_antal,
mean_temp_6h,
mean_precip_6h,
mean_precip_dur_6h,
mean_wind_speed_6h
) # y-variable + 13 + tidspunktskategori, lokalopgør, weekend, type
samlet_data_flot |>
mutate(
kampstart = as.POS (kampstart, format = "%H:%M:%S")
)
samlet_data_flot |>
mutate(
kampstart = as.POSIXct(tid_hms, format = "%H:%M:%S")
)
samlet_data_flot |>
mutate(
kampstart = parse_time(kampstart)
)
samlet_data_flot |>
mutate(
kampstart = as.character(kampstart)
)
samlet_data_flot |>
mutate(
kampstart = parse_time(as.character(kampstart))
)
samlet_data_flot |>
mutate(
kampstart = strptime(as.character(kampstart), format = "%H:%M:%S")
)
samlet_data_flot |>
mutate(
kampstart = strptime(kampstart, format = "%H:%M:%S")
)
samlet_data <- as_tibble(samlet_vff) |>
mutate(
dato = as.Date(dato, origin = "1970-01-01"),
kampstart = hms(parse_time(kampstart)),
tid = hms(parse_time(tid))
)
samlet_data_flot <- samlet_data |>
filter(
kampstart >= tid & kampstart - hours(6) <= tid
) |>
group_by(dato) |>
mutate(
mean_temp_6h = round(mean(temp_mean_past1h), 1),
mean_precip_6h = round(mean(precip_past1h), 1),
mean_precip_dur_6h = round(mean(precip_dur_past1h), 1),
mean_wind_speed_6h = round(mean(wind_speed_past1h), 1)
) |>
slice_head() |>
ungroup() |>
select(dato,
kampstart,
ugedag,
runde,
ude,
mean_spild,
sidste_spild,
mean_afhentningsgrad,
mean_tilskuere,
sidste_tilskuer_antal,
mean_temp_6h,
mean_precip_6h,
mean_precip_dur_6h,
mean_wind_speed_6h
) # y-variable + 13 + tidspunktskategori, lokalopgør, weekend, type
samlet_data_flot |>
mutate(
kampstart = strptime(kampstart, format = "%H:%M:%S")
)
# Få rettet query når alle tabeller er klar
samlet_sql_query <- dbGetQuery(connection,
"select vff.dato, vff.ugedag, vff.ude, vff.mean_spild, vff.sidste_spild, vff.mean_afhentningsgrad,
superstats.kampstart, superstats.runde, superstats.mean_tilskuere, superstats.sidste_tilskuer_antal,
dmi.tid, dmi.temp_mean_past1h, dmi.precip_dur_past1h, dmi.precip_past1h, dmi.wind_speed_past1h
from vff
left join superstats ON vff.dato = superstats.dato
left join dmi ON vff.dato = dmi.dato
where dmi.temp_mean_past1h is not NULL")
samlet_data <- as_tibble(samlet_vff) |>
mutate(
dato = as.Date(dato, origin = "1970-01-01"),
kampstart = parse_time(kampstart),
tid = parse_time(tid)
)
samlet_data_flot <- samlet_data |>
filter(
kampstart >= tid & kampstart - hour(6) <= tid
) |>
group_by(dato) |>
mutate(
mean_temp_6h = round(mean(temp_mean_past1h), 1),
mean_precip_6h = round(mean(precip_past1h), 1),
mean_precip_dur_6h = round(mean(precip_dur_past1h), 1),
mean_wind_speed_6h = round(mean(wind_speed_past1h), 1)
) |>
slice_head() |>
ungroup() |>
select(dato,
kampstart,
ugedag,
runde,
ude,
mean_spild,
sidste_spild,
mean_afhentningsgrad,
mean_tilskuere,
sidste_tilskuer_antal,
mean_temp_6h,
mean_precip_6h,
mean_precip_dur_6h,
mean_wind_speed_6h
) # y-variable + 13 + tidspunktskategori, lokalopgør, weekend, type
samlet_data <- as_tibble(samlet_vff) |>
mutate(
dato = as.Date(dato, origin = "1970-01-01"),
kampstart = hms(parse_time(kampstart)),
tid = hms(parse_time(tid))
)
samlet_data_flot <- samlet_data |>
filter(
kampstart >= tid & kampstart - hours(6) <= tid
) |>
group_by(dato) |>
mutate(
mean_temp_6h = round(mean(temp_mean_past1h), 1),
mean_precip_6h = round(mean(precip_past1h), 1),
mean_precip_dur_6h = round(mean(precip_dur_past1h), 1),
mean_wind_speed_6h = round(mean(wind_speed_past1h), 1)
) |>
slice_head() |>
ungroup() |>
select(dato,
kampstart,
ugedag,
runde,
ude,
mean_spild,
sidste_spild,
mean_afhentningsgrad,
mean_tilskuere,
sidste_tilskuer_antal,
mean_temp_6h,
mean_precip_6h,
mean_precip_dur_6h,
mean_wind_speed_6h
) # y-variable + 13 + tidspunktskategori, lokalopgør, weekend, type
samlet_data_flot
samlet_data_flot |>
mutate(
kampstart = sprintf("%02d:%02d", hour(tid), minute(tid))
)
samlet_data_flot |>
mutate(
kampstart = sprintf("%02d:%02d", hour(kampstart), minute(kampstart))
)
samlet_data_flot |>
mutate(
kampstart = parse_time(sprintf("%02d:%02d", hour(kampstart), minute(kampstart)))
)
samlet_data_flot <- samlet_data |>
filter(
kampstart >= tid & kampstart - hours(6) <= tid
) |>
group_by(dato) |>
mutate(
mean_temp_6h = round(mean(temp_mean_past1h), 1),
mean_precip_6h = round(mean(precip_past1h), 1),
mean_precip_dur_6h = round(mean(precip_dur_past1h), 1),
mean_wind_speed_6h = round(mean(wind_speed_past1h), 1),
dag_type = ifelse(ugedag %in% c("lørdag", "søndag"), "Weekend", "Hverdag"),
) |>
slice_head() |>
ungroup() |>
select(dato,
kampstart,
ugedag,
dag_type,
runde,
ude,
mean_spild,
sidste_spild,
mean_afhentningsgrad,
mean_tilskuere,
sidste_tilskuer_antal,
mean_temp_6h,
mean_precip_6h,
mean_precip_dur_6h,
mean_wind_speed_6h
) # y-variable + 13 + tidspunktskategori, lokalopgør, weekend, type
samlet_data_flot |>
arrange(desc(mean_tilskuere)) %>%
mutate(
type = case_when(
row_number() <= 3 ~ "A",  # Top 3 hold er A
row_number() <= 7 ~ "B",  # Næste 4 hold er B
TRUE ~ "C"               # Resterende hold er C
)
)
samlet_data_flot |>
arrange(desc(mean_tilskuere)) %>%
mutate(
type = case_when(
row_number() <= 3 ~ "A",  # Top 3 hold er A
row_number() <= 7 ~ "B",  # Næste 4 hold er B
TRUE ~ "C"               # Resterende hold er C
),
.keep = "used"
)
samlet_data_flot |>
group_by(ude) |>
arrange(desc(mean_tilskuere)) %>%
mutate(
type = case_when(
row_number() <= 3 ~ "A",  # Top 3 hold er A
row_number() <= 7 ~ "B",  # Næste 4 hold er B
TRUE ~ "C"               # Resterende hold er C
),
.keep = "used"
)
arrange(desc(mean_tilskuere)) |>
mutate(
type = case_when(
row_number() <= 3 ~ "A",  # Top 3 hold er A
row_number() <= 7 ~ "B",  # Næste 4 hold er B
TRUE ~ "C"               # Resterende hold er C
),
.keep = "used"
)
samlet_data_flot |>
group_by(ude) |>
summarise(
mean_tilskuere
)
arrange(desc(mean_tilskuere)) |>
mutate(
type = case_when(
row_number() <= 3 ~ "A",  # Top 3 hold er A
row_number() <= 7 ~ "B",  # Næste 4 hold er B
TRUE ~ "C"               # Resterende hold er C
),
)
samlet_data_flot |>
group_by(ude) |>
arrange(desc(mean_tilskuere))
samlet_data_flot |>
group_by(ude) |>
summarise(
gennemsnit_tilskuere = mean(tilskuere, na.rm = TRUE)
) |>
arrange(desc(gennemsnit_tilskuere)) |>
mutate(
type = case_when(
row_number() <= 3 ~ "A",  # Top 3 hold er A
row_number() <= 7 ~ "B",  # Næste 4 hold er B
TRUE ~ "C"               # Resterende hold er C
)
)
samlet_data_flot |>
group_by(ude) |>
summarise(
mean_tilskuere = mean_tilskuere
) |>
arrange(desc(mean_tilskuere)) |>
mutate(
type = case_when(
row_number() <= 3 ~ "A",  # Top 3 hold er A
row_number() <= 7 ~ "B",  # Næste 4 hold er B
TRUE ~ "C"               # Resterende hold er C
)
)
samlet_data_flot |>
group_by(ude) |>
summarize(
mean_tilskuere = mean_tilskuere
) |>
arrange(desc(mean_tilskuere)) |>
mutate(
type = case_when(
row_number() <= 3 ~ "A",  # Top 3 hold er A
row_number() <= 7 ~ "B",  # Næste 4 hold er B
TRUE ~ "C"               # Resterende hold er C
)
)
?reframe
samlet_data_flot |>
group_by(ude) |>
reframe() |>
arrange(desc(mean_tilskuere)) |>
mutate(
type = case_when(
row_number() <= 3 ~ "A",  # Top 3 hold er A
row_number() <= 7 ~ "B",  # Næste 4 hold er B
TRUE ~ "C"               # Resterende hold er C
)
)
samlet_data_flot |>
group_by(ude) |>
reframe()
samlet_data_flot |>
group_by(ude) |>
reframe(mean_tilskuere) |>
arrange(desc(mean_tilskuere)) |>
mutate(
type = case_when(
row_number() <= 3 ~ "A",  # Top 3 hold er A
row_number() <= 7 ~ "B",  # Næste 4 hold er B
TRUE ~ "C"               # Resterende hold er C
)
)
samlet_data_flot |>
group_by(ude) |>
slice_head() |>
arrange(desc(mean_tilskuere)) |>
mutate(
type = case_when(
row_number() <= 3 ~ "A",  # Top 3 hold er A
row_number() <= 7 ~ "B",  # Næste 4 hold er B
TRUE ~ "C"               # Resterende hold er C
)
)
samlet_data_flot |>
group_by(ude) |>
summarise(
mean_tilskuere = mean_tilskuere
) |>
arrange(desc(mean_tilskuere)) |>
mutate(
type = case_when(
row_number() <= 3 ~ "A",  # Top 3 hold er A
row_number() <= 7 ~ "B",  # Næste 4 hold er B
TRUE ~ "C"               # Resterende hold er C
)
)
samlet_data_flot |>
group_by(ude) |>
summarise(
mean_tilskuere = mean_tilskuere
samlet_data_flot |>
group_by(ude) |>
summarise(
mean_tilskuere = mean_tilskuere
)
samlet_data_flot |>
group_by(ude) |>
summarise(
mean_tilskuere = mean(mean_tilskuere)
) |>
arrange(desc(mean_tilskuere)) |>
mutate(
type = case_when(
row_number() <= 3 ~ "A",  # Top 3 hold er A
row_number() <= 7 ~ "B",  # Næste 4 hold er B
TRUE ~ "C"               # Resterende hold er C
)
)
samlet_data_flot |>
group_by(ude) |>
slice_head() |>
arrange(desc(mean_tilskuere)) |>
mutate(
type = case_when(
row_number() <= 3 ~ "A",  # Top 3 hold er A
row_number() <= 7 ~ "B",  # Næste 4 hold er B
TRUE ~ "C"               # Resterende hold er C
)
)
kamp_type <- samlet_data_flot |>
group_by(ude) |>
slice_head() |>
arrange(desc(mean_tilskuere)) |>
mutate(
kamp_type = case_when(
row_number() <= 3 ~ "A",  # Top 3 hold er A
row_number() <= 7 ~ "B",  # Næste 4 hold er B
TRUE ~ "C"               # Resterende hold er C
)
) |>
select(ude, kamp_type)
kamp_type
kamp_type <- samlet_data_flot |>
group_by(ude) |>
slice_head()
kamp_type
samlet_data_flot |>
group_by(ude) |>
slice_head() |>
arrange(desc(mean_tilskuere))
kamp_type <- samlet_data_flot |>
group_by(ude) |>
slice_head() |>
arrange(desc(mean_tilskuere)) |>
mutate(
kamp_type = case_when(
row_number() <= 3 ~ "A",  # Top 3 hold er A
row_number() <= 7 ~ "B",  # Næste 4 hold er B
TRUE ~ "C"               # Resterende hold er C
)
) |>
select(ude, kamp_type)
kamp_type
kamp_type <- samlet_data_flot |>
select(ude, mean_tilskuere) |>
group_by(ude) |>
samlet_data_flot |>
mutate(
kampstart = parse_time(sprintf("%02d:%02d", hour(kampstart), minute(kampstart)))
)
samlet_data_flot |>
select(ude, mean_tilskuere) |>
group_by(ude)
samlet_data_flot |>
select(ude, mean_tilskuere) |>
group_by(ude) |>
slice_head()
mean(samlet_data_flot$mean_tilskuere)
superstats <- readRDS("data/superstats.rds")
mean(superstats$tilskuere)
overall_mean_tilskuere <- mean(superstats$tilskuere) # = 5401
kamp_type <- samlet_data_flot |>
select(ude, mean_tilskuere) |>
group_by(ude) |>
slice_head() |>
mutate(
tilskuer_scoring = mean_tilskuere / overall_mean_tilskuere
)
View(kamp_type)
kamp_type <- samlet_data_flot |>
select(ude, mean_tilskuere) |>
group_by(ude) |>
slice_head() |>
mutate(
tilskuer_scoring = round((mean_tilskuere / overall_mean_tilskuere), 1)
)
samlet_data_flot <- samlet_data |>
filter(
kampstart >= tid & kampstart - hours(6) <= tid
) |>
group_by(dato) |>
mutate(
mean_temp_6h = round(mean(temp_mean_past1h), 1),
mean_precip_6h = round(mean(precip_past1h), 1),
mean_precip_dur_6h = round(mean(precip_dur_past1h), 1),
mean_wind_speed_6h = round(mean(wind_speed_past1h), 1),
dag_type = ifelse(ugedag %in% c("lørdag", "søndag"), "Weekend", "Hverdag"),
tilskuer_scoring = round((mean_tilskuere / overall_mean_tilskuere), 1)
) |>
slice_head() |>
ungroup() |>
select(dato,
kampstart,
ugedag,
dag_type,
runde,
ude,
mean_spild,
sidste_spild,
mean_afhentningsgrad,
mean_tilskuere,
sidste_tilskuer_antal,
tilskuer_scoring,
mean_temp_6h,
mean_precip_6h,
mean_precip_dur_6h,
mean_wind_speed_6h
) # y-variable + 13 + tidspunktskategori, lokalopgør, weekend, type
View(samlet_data_flot)
